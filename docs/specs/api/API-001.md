# API-001: Create Execution

## Metadata
- **ID**: API-001
- **Created**: 2025-12-26
- **Status**: Approved

## Endpoint
- **Method**: POST
- **Path**: `/api/v1/executions`
- **Authentication**: Required (API Key or JWT)

## Description
새로운 Claude Agent 실행을 생성합니다. K8s Job을 생성하여 Agent를 실행합니다.

## Request

### Headers
| Header | Required | Description |
|--------|----------|-------------|
| Authorization | Yes | `Bearer {token}` or `ApiKey {key}` |
| Content-Type | Yes | `application/json` |
| X-Request-ID | No | 요청 추적용 ID (없으면 자동 생성) |

### Body
```json
{
  "prompt": "string (required) - Agent에게 전달할 프롬프트",
  "model": "string (optional) - Claude 모델 ID (기본: claude-sonnet-4-20250514)",
  "maxTokens": "number (optional) - 최대 토큰 수 (기본: 4096, 최대: 200000)",
  "timeout": "number (optional) - 타임아웃 초 (기본: 1800, 최대: 3600)",
  "callbackUrl": "string (optional) - 완료 시 콜백 URL",
  "metadata": {
    "key": "value (optional) - 사용자 정의 메타데이터"
  },
  "resources": {
    "memoryRequest": "string (optional) - 메모리 요청 (예: 512Mi)",
    "memoryLimit": "string (optional) - 메모리 제한 (예: 2Gi)",
    "cpuRequest": "string (optional) - CPU 요청 (예: 500m)",
    "cpuLimit": "string (optional) - CPU 제한 (예: 2000m)"
  }
}
```

### Example Request
```json
{
  "prompt": "주어진 코드베이스를 분석하고 README.md를 생성해주세요.",
  "model": "claude-sonnet-4-20250514",
  "maxTokens": 8192,
  "timeout": 600,
  "metadata": {
    "project": "my-project",
    "requestedBy": "user@example.com"
  }
}
```

## Response

### Success (201 Created)
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "status": "PENDING",
  "jobName": "claude-agent-550e8400",
  "prompt": "주어진 코드베이스를 분석하고 README.md를 생성해주세요.",
  "model": "claude-sonnet-4-20250514",
  "maxTokens": 8192,
  "metadata": {
    "project": "my-project",
    "requestedBy": "user@example.com"
  },
  "createdAt": "2025-12-26T10:00:00Z",
  "updatedAt": "2025-12-26T10:00:00Z"
}
```

### Error Codes
| Code | HTTP Status | Description |
|------|-------------|-------------|
| VALIDATION_ERROR | 400 | 요청 데이터 유효성 검사 실패 |
| UNAUTHORIZED | 401 | 인증 실패 |
| FORBIDDEN | 403 | 권한 없음 |
| RATE_LIMITED | 429 | 요청 제한 초과 |
| CONCURRENT_LIMIT | 429 | 동시 실행 제한 초과 |
| INTERNAL_ERROR | 500 | 서버 내부 오류 |

### Error Response Example
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid request parameters",
    "details": [
      {
        "field": "prompt",
        "message": "prompt is required"
      }
    ]
  },
  "requestId": "req-123456"
}
```

## Validation Rules

| Field | Rules |
|-------|-------|
| prompt | Required, 1-100000 characters |
| model | Optional, valid Claude model ID |
| maxTokens | Optional, 1-200000 |
| timeout | Optional, 60-3600 |
| callbackUrl | Optional, valid HTTPS URL |
| resources.memoryRequest | Optional, valid K8s resource format |
| resources.memoryLimit | Optional, valid K8s resource format |
| resources.cpuRequest | Optional, valid K8s resource format |
| resources.cpuLimit | Optional, valid K8s resource format |

## Rate Limits

| Limit Type | Value |
|------------|-------|
| Requests per minute | 60 |
| Concurrent executions | 10 |
| Max prompt size | 100KB |

## Related Specs
- FEAT-002
- DATA-001

---

## Change History

| Date | Author | Description |
|------|--------|-------------|
| 2025-12-26 | System | Initial creation |
