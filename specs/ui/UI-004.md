# UI-004: Common Layout & Authentication UI

## Metadata
- **ID**: UI-004
- **Created**: 2025-12-27
- **Status**: Approved
- **Priority**: High
- **Related Backend**: FEAT-001 (System Architecture)
- **Related APIs**: All APIs (Authentication)

## Overview
프론트엔드 공통 레이아웃, 네비게이션, 인증 UI, 공유 컴포넌트를 정의합니다.
모든 UI 컴포넌트의 기반이 되는 명세입니다.

## Requirements

### REQ-1: Application Layout
```
┌─────────────────────────────────────────────────────────────┐
│ Header                                         [User Menu]  │
├──────────────┬──────────────────────────────────────────────┤
│              │                                              │
│   Sidebar    │              Main Content                    │
│   (Nav)      │                                              │
│              │                                              │
│              │                                              │
│              │                                              │
│              │                                              │
│              │                                              │
│              │                                              │
├──────────────┴──────────────────────────────────────────────┤
│ Footer (optional)                                           │
└─────────────────────────────────────────────────────────────┘
```

- [ ] 반응형 레이아웃 (모바일: 햄버거 메뉴)
- [ ] 사이드바 접기/펼치기 토글
- [ ] 다크 모드 지원
- [ ] 브레드크럼 네비게이션

### REQ-2: Navigation Structure
```typescript
const navigation = [
  {
    name: 'Dashboard',
    href: '/dashboard',
    icon: 'LayoutDashboard',
  },
  {
    name: 'Executions',
    href: '/executions',
    icon: 'Play',
    children: [
      { name: 'All Executions', href: '/executions' },
      { name: 'New Execution', href: '/executions/new' },
    ],
  },
  {
    name: 'History',
    href: '/history',
    icon: 'History',
  },
  {
    name: 'Artifacts',
    href: '/artifacts',
    icon: 'FolderOpen',
  },
  {
    name: 'Statistics',
    href: '/statistics',
    icon: 'BarChart3',
  },
  {
    name: 'Settings',
    href: '/settings',
    icon: 'Settings',
  },
];
```

### REQ-3: Header Component
- [ ] 로고 및 앱 이름
- [ ] 글로벌 검색 바 (선택)
- [ ] 알림 벨 아이콘 (실행 완료 알림)
- [ ] 사용자 메뉴 (프로필, 설정, 로그아웃)
- [ ] 테마 토글 (라이트/다크)

### REQ-4: Authentication UI

#### Login Page
- [ ] 이메일/비밀번호 로그인 폼
- [ ] API Key 로그인 옵션
- [ ] "Remember me" 체크박스
- [ ] 비밀번호 찾기 링크
- [ ] 로그인 에러 표시

#### Session Management
- [ ] JWT 토큰 저장 (httpOnly cookie 권장)
- [ ] 토큰 자동 갱신
- [ ] 세션 만료 경고 모달
- [ ] 자동 로그아웃 후 리다이렉트

```typescript
// Auth Context
interface AuthContext {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  login: (credentials: LoginCredentials) => Promise<void>;
  logout: () => Promise<void>;
  refreshToken: () => Promise<void>;
}

interface User {
  id: string;
  email: string;
  name: string;
  role: 'admin' | 'user';
  avatar?: string;
}
```

### REQ-5: Toast Notifications
```typescript
// Toast types
type ToastType = 'success' | 'error' | 'warning' | 'info';

interface Toast {
  id: string;
  type: ToastType;
  title: string;
  description?: string;
  duration?: number;  // ms, default: 5000
  action?: {
    label: string;
    onClick: () => void;
  };
}

// Usage examples
toast.success('Execution completed', { description: 'ID: abc-123' });
toast.error('Failed to create execution', { description: error.message });
toast.info('Execution started', {
  action: { label: 'View', onClick: () => navigate(`/executions/${id}`) }
});
```

### REQ-6: Error Handling UI
- [ ] 404 Not Found 페이지
- [ ] 500 Server Error 페이지
- [ ] 네트워크 오류 표시
- [ ] API 에러 핸들링 (토스트)
- [ ] 폼 유효성 에러 표시

```typescript
// Error Boundary
interface ErrorFallbackProps {
  error: Error;
  resetErrorBoundary: () => void;
}

// API Error Handler
interface ApiError {
  status: number;
  code: string;
  message: string;
  details?: Record<string, string[]>;
}

function handleApiError(error: ApiError) {
  switch (error.status) {
    case 401:
      // Redirect to login
      break;
    case 403:
      toast.error('권한이 없습니다');
      break;
    case 404:
      toast.error('리소스를 찾을 수 없습니다');
      break;
    default:
      toast.error(error.message);
  }
}
```

### REQ-7: Loading States
- [ ] 전체 페이지 로딩 스피너
- [ ] 컴포넌트별 Skeleton UI
- [ ] 버튼 로딩 상태
- [ ] 인피니트 스크롤 로딩

```typescript
// Skeleton components
<Skeleton className="h-4 w-[200px]" />  // Text
<Skeleton className="h-12 w-12 rounded-full" />  // Avatar
<Skeleton className="h-[200px] w-full" />  // Card
```

### REQ-8: Common UI Components
```
src/components/ui/
├── Button.tsx
├── Input.tsx
├── Select.tsx
├── Checkbox.tsx
├── Dialog.tsx
├── Dropdown.tsx
├── Table.tsx
├── Pagination.tsx
├── Badge.tsx
├── Card.tsx
├── Tabs.tsx
├── Tooltip.tsx
├── Avatar.tsx
├── Skeleton.tsx
├── Toast.tsx
├── Alert.tsx
├── Breadcrumb.tsx
├── EmptyState.tsx
└── ConfirmDialog.tsx
```

### REQ-9: Theme System
```typescript
// Theme configuration
const theme = {
  colors: {
    primary: {
      50: '#eff6ff',
      100: '#dbeafe',
      // ...
      500: '#3b82f6',
      // ...
      900: '#1e3a8a',
    },
    // semantic colors
    success: '#22c55e',
    warning: '#f59e0b',
    error: '#ef4444',
    info: '#3b82f6',
  },
  spacing: {
    // Tailwind defaults
  },
  borderRadius: {
    sm: '0.25rem',
    md: '0.375rem',
    lg: '0.5rem',
    xl: '0.75rem',
  },
};

// Dark mode
const darkTheme = {
  background: '#0f172a',
  foreground: '#f8fafc',
  card: '#1e293b',
  border: '#334155',
  // ...
};
```

### REQ-10: Accessibility (a11y)
- [ ] ARIA 레이블 적용
- [ ] 키보드 네비게이션 지원
- [ ] 포커스 표시자
- [ ] 스크린 리더 호환
- [ ] 색상 대비 기준 충족 (WCAG AA)
- [ ] 폼 필드 레이블링

### REQ-11: Internationalization (i18n) - Optional
```typescript
// 향후 다국어 지원을 위한 구조
const messages = {
  ko: {
    common: {
      save: '저장',
      cancel: '취소',
      delete: '삭제',
      confirm: '확인',
    },
    executions: {
      create: '새 실행',
      list: '실행 목록',
    },
  },
  en: {
    // ...
  },
};
```

## Page Routes

| Route | Page | Auth Required |
|-------|------|---------------|
| `/login` | LoginPage | No |
| `/` | Redirect to /dashboard | Yes |
| `/dashboard` | DashboardPage | Yes |
| `/settings` | SettingsPage | Yes |
| `/404` | NotFoundPage | No |
| `/500` | ErrorPage | No |

## Components Structure

```
src/
├── app/
│   ├── layout.tsx            # Root layout
│   ├── login/
│   │   └── page.tsx          # Login page
│   ├── settings/
│   │   └── page.tsx          # Settings page
│   └── (authenticated)/
│       └── layout.tsx        # Auth-required layout
├── components/
│   ├── layout/
│   │   ├── Header.tsx
│   │   ├── Sidebar.tsx
│   │   ├── Footer.tsx
│   │   ├── Breadcrumb.tsx
│   │   └── MainLayout.tsx
│   ├── auth/
│   │   ├── LoginForm.tsx
│   │   ├── AuthGuard.tsx
│   │   └── UserMenu.tsx
│   ├── ui/
│   │   └── ...               # Common UI components
│   └── feedback/
│       ├── Toast.tsx
│       ├── LoadingSpinner.tsx
│       ├── ErrorBoundary.tsx
│       └── EmptyState.tsx
├── contexts/
│   ├── AuthContext.tsx
│   ├── ThemeContext.tsx
│   └── ToastContext.tsx
├── hooks/
│   ├── useAuth.ts
│   ├── useTheme.ts
│   └── useToast.ts
├── lib/
│   ├── api.ts                # API client (axios/fetch)
│   ├── auth.ts               # Auth utilities
│   └── utils.ts              # Common utilities
└── styles/
    └── globals.css           # Global styles
```

## API Client Setup

```typescript
// lib/api.ts
import axios from 'axios';

export const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// Request interceptor - add auth token
api.interceptors.request.use((config) => {
  const token = getAuthToken();
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});

// Response interceptor - handle errors
api.interceptors.response.use(
  (response) => response.data,
  (error) => {
    if (error.response?.status === 401) {
      // Handle unauthorized
      redirectToLogin();
    }
    return Promise.reject(error.response?.data || error);
  }
);
```

## State Management

```typescript
// 권장: React Context + React Query (TanStack Query)
// - Server state: React Query (캐싱, 리페칭, 에러 핸들링)
// - Client state: React Context 또는 Zustand

// React Query 설정
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60,      // 1 minute
      refetchOnWindowFocus: false,
      retry: 1,
    },
  },
});
```

## Verification Criteria

- [ ] 레이아웃이 모든 페이지에 일관되게 적용됨
- [ ] 반응형이 모바일/태블릿/데스크톱에서 동작함
- [ ] 다크 모드 전환이 정상 동작함
- [ ] 로그인/로그아웃 플로우가 동작함
- [ ] 인증되지 않은 사용자가 보호된 페이지 접근 시 리다이렉트됨
- [ ] 토스트 알림이 정상 표시됨
- [ ] 에러 페이지가 올바르게 표시됨
- [ ] 키보드 네비게이션이 동작함

## Related Specs

- **Backend**: FEAT-001 (System Architecture)
- **Related UI**: UI-001, UI-002, UI-003 (모든 UI가 이 레이아웃 사용)

---

## Change History

| Date | Author | Description |
|------|--------|-------------|
| 2025-12-27 | Claude | Initial creation |
