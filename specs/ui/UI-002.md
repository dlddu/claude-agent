# UI-002: History & Statistics UI

## Metadata
- **ID**: UI-002
- **Created**: 2025-12-27
- **Status**: Approved
- **Priority**: High
- **Related Backend**: FEAT-003 (Execution History Management)
- **Related APIs**: API-003

## Overview
실행 히스토리 조회 및 통계 대시보드 UI를 정의합니다.
FEAT-003의 백엔드 기능과 함께 구현되어야 합니다.

## Feature Pairing (Backend-Frontend)

| Backend (FEAT-003) | Frontend (UI-002) |
|-------------------|-------------------|
| REQ-1: History Data Storage | 히스토리 목록 표시 |
| REQ-2: Data Retention Policy | 보존 기간/영구 보존 UI |
| REQ-3: Query Capabilities | 고급 필터링 UI |
| REQ-5: Status Transition Logging | 상태 변경 타임라인 |
| REQ-6: Statistics & Analytics | 통계 대시보드 |

## Requirements

### REQ-1: Dashboard Page
- [ ] 오늘의 실행 요약 카드
  - 총 실행 수
  - 성공/실패/진행중 수
  - 성공률
- [ ] 최근 실행 목록 (최근 10개)
- [ ] 토큰 사용량 요약
- [ ] 예상 비용 요약
- [ ] 빠른 실행 생성 버튼

### REQ-2: Statistics Charts
- [ ] 일별/주별/월별 실행 수 차트 (Bar/Line)
- [ ] 상태별 분포 차트 (Pie/Donut)
- [ ] 평균 실행 시간 추이 (Line)
- [ ] 토큰 사용량 추이 (Area)
- [ ] 비용 추이 (Area)
- [ ] 기간 선택기 (최근 7일, 30일, 90일, 커스텀)

### REQ-3: Advanced History Filters
```typescript
interface HistoryFilterUI {
  // 상태 필터 (다중 선택)
  status: ExecutionStatus[];

  // 날짜 범위
  dateRange: {
    from: Date;
    to: Date;
  };

  // 모델 필터
  model?: string;

  // 프롬프트 검색
  search?: string;

  // 아티팩트 유무
  hasArtifacts?: boolean;

  // 비용 범위
  costRange?: {
    min: number;
    max: number;
  };

  // 실행 시간 범위 (초)
  durationRange?: {
    min: number;
    max: number;
  };
}
```

- [ ] 필터 프리셋 저장/불러오기
- [ ] 필터 초기화 버튼
- [ ] 활성 필터 표시 (태그 형태)

### REQ-4: History Detail View
- [ ] 상태 변경 타임라인
  ```
  ┌─────────────────────────────────────┐
  │ ● PENDING    10:00:00              │
  │ │                                   │
  │ ● RUNNING    10:00:05  (+5s)       │
  │ │                                   │
  │ ● COMPLETED  10:02:30  (+2m 25s)   │
  └─────────────────────────────────────┘
  ```
- [ ] 각 상태 전환의 이유 표시
- [ ] 전체 실행 시간 표시

### REQ-5: Export & Reporting
- [ ] 필터된 데이터 CSV 내보내기
- [ ] 통계 리포트 PDF 생성
- [ ] 날짜 범위 지정 내보내기

### REQ-6: Retention Management
- [ ] 보존 기간 만료 예정 항목 표시
- [ ] 영구 보존 설정/해제 버튼
- [ ] 수동 삭제 기능 (권한 필요)

## Page Routes

| Route | Page | Description |
|-------|------|-------------|
| `/` or `/dashboard` | DashboardPage | 대시보드 |
| `/history` | HistoryPage | 히스토리 목록 |
| `/statistics` | StatisticsPage | 상세 통계 |

## Components Structure

```
src/
├── app/
│   ├── page.tsx                  # 대시보드 (리다이렉트)
│   ├── dashboard/
│   │   └── page.tsx              # 대시보드
│   ├── history/
│   │   └── page.tsx              # 히스토리
│   └── statistics/
│       └── page.tsx              # 통계
├── components/
│   ├── dashboard/
│   │   ├── SummaryCards.tsx      # 요약 카드들
│   │   ├── RecentExecutions.tsx  # 최근 실행
│   │   ├── QuickStats.tsx        # 빠른 통계
│   │   └── UsageOverview.tsx     # 사용량 개요
│   ├── history/
│   │   ├── HistoryTable.tsx      # 히스토리 테이블
│   │   ├── HistoryFilters.tsx    # 고급 필터
│   │   ├── StatusTimeline.tsx    # 상태 타임라인
│   │   ├── FilterPresets.tsx     # 필터 프리셋
│   │   └── ExportButton.tsx      # 내보내기
│   └── statistics/
│       ├── ExecutionChart.tsx    # 실행 수 차트
│       ├── StatusPieChart.tsx    # 상태 분포
│       ├── TokenUsageChart.tsx   # 토큰 사용량
│       ├── CostChart.tsx         # 비용 차트
│       ├── DurationChart.tsx     # 실행 시간
│       ├── PeriodSelector.tsx    # 기간 선택
│       └── StatsCard.tsx         # 통계 카드
├── hooks/
│   ├── useStatistics.ts          # 통계 조회
│   ├── useHistory.ts             # 히스토리 조회
│   └── useExport.ts              # 내보내기
└── services/
    └── statisticsApi.ts          # 통계 API
```

## Chart Library

```typescript
// 권장: Recharts 또는 Chart.js
// Recharts 예시
import {
  LineChart,
  BarChart,
  PieChart,
  AreaChart,
  ResponsiveContainer,
} from 'recharts';

// 차트 공통 설정
const chartConfig = {
  colors: {
    primary: '#3b82f6',    // blue-500
    success: '#22c55e',    // green-500
    warning: '#f59e0b',    // amber-500
    error: '#ef4444',      // red-500
    neutral: '#6b7280',    // gray-500
  },
  animation: {
    duration: 300,
  },
};
```

## Statistics API Integration

```typescript
// services/statisticsApi.ts
export const statisticsApi = {
  // 대시보드 요약
  getDashboardSummary: (): Promise<DashboardSummary> =>
    api.get('/statistics/summary'),

  // 기간별 통계
  getStatistics: (params: StatisticsParams): Promise<ExecutionStatistics> =>
    api.get('/statistics', { params }),

  // 일별 통계
  getDailyStats: (from: Date, to: Date): Promise<DailyStats[]> =>
    api.get('/statistics/daily', { params: { from, to } }),

  // 내보내기
  exportHistory: (filter: HistoryFilter, format: 'csv' | 'pdf'): Promise<Blob> =>
    api.get('/history/export', {
      params: { ...filter, format },
      responseType: 'blob',
    }),
};

// Types
interface DashboardSummary {
  today: {
    total: number;
    success: number;
    failed: number;
    running: number;
    successRate: number;
  };
  tokens: {
    used: number;
    trend: number; // 전일 대비 %
  };
  cost: {
    estimated: number;
    trend: number;
  };
  recentExecutions: ExecutionResponse[];
}

interface StatisticsParams {
  period: 'daily' | 'weekly' | 'monthly';
  from: Date;
  to: Date;
}
```

## Dashboard Layout

```
┌─────────────────────────────────────────────────────────────┐
│                        Header                                │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ Total   │ │ Success │ │ Failed  │ │ Running │           │
│  │   42    │ │   38    │ │    2    │ │    2    │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
├─────────────────────────────────────────────────────────────┤
│  ┌───────────────────────────┐ ┌───────────────────────────┐│
│  │   Execution Trend (7d)    │ │   Token Usage (7d)        ││
│  │   [========Chart=======]  │ │   [========Chart=======]  ││
│  └───────────────────────────┘ └───────────────────────────┘│
├─────────────────────────────────────────────────────────────┤
│  Recent Executions                            [View All →]  │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ ID        Status    Prompt          Time       Duration ││
│  │ abc-123   ✓ Done    Fix the bug...  10:30      2m 30s   ││
│  │ def-456   ● Run     Add feature...  10:28      -        ││
│  │ ...                                                      ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

## Verification Criteria

- [ ] 대시보드 요약 정보가 올바르게 표시됨
- [ ] 모든 차트가 정상적으로 렌더링됨
- [ ] 기간 선택 시 차트가 업데이트됨
- [ ] 고급 필터가 정상 동작함
- [ ] 상태 타임라인이 올바르게 표시됨
- [ ] CSV/PDF 내보내기가 동작함
- [ ] 반응형 레이아웃이 적용됨

## Related Specs

- **Backend**: FEAT-003 (Execution History Management)
- **APIs**: API-003
- **Related UI**: UI-001 (Execution UI), UI-004 (Common Layout)

---

## Change History

| Date | Author | Description |
|------|--------|-------------|
| 2025-12-27 | Claude | Initial creation |
