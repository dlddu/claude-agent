# API-005: Artifact Management APIs

## Metadata
- **ID**: API-005
- **Created**: 2025-12-26
- **Status**: Approved

## Overview
아티팩트(파일) 조회 및 다운로드를 위한 API 명세입니다.

---

## 5.1 List Artifacts

### Endpoint
- **Method**: GET
- **Path**: `/api/v1/executions/{executionId}/artifacts`
- **Authentication**: Required

### Description
특정 실행의 모든 아티팩트 목록을 조회합니다.

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| executionId | UUID | Yes | 실행 ID |

### Query Parameters
| Parameter | Type | Required | Description | Default |
|-----------|------|----------|-------------|---------|
| type | string | No | 아티팩트 타입 필터 | - |
| status | string | No | 상태 필터 | ACTIVE |

### Response (200 OK)
```json
{
  "executionId": "550e8400-e29b-41d4-a716-446655440000",
  "artifacts": [
    {
      "id": "artifact-uuid-1",
      "fileName": "README.md",
      "filePath": "artifacts/550e8400/output/README.md",
      "fileSize": 2048,
      "mimeType": "text/markdown",
      "type": "DOCUMENT",
      "status": "ACTIVE",
      "checksum": "sha256:abc123...",
      "createdAt": "2025-12-26T10:02:25Z",
      "expiresAt": "2026-01-25T10:02:25Z"
    },
    {
      "id": "artifact-uuid-2",
      "fileName": "agent.log",
      "filePath": "artifacts/550e8400/logs/agent.log",
      "fileSize": 15360,
      "mimeType": "text/plain",
      "type": "LOG",
      "status": "ACTIVE",
      "createdAt": "2025-12-26T10:02:30Z"
    }
  ],
  "totalCount": 2,
  "totalSize": 17408
}
```

---

## 5.2 Get Artifact

### Endpoint
- **Method**: GET
- **Path**: `/api/v1/artifacts/{id}`
- **Authentication**: Required

### Description
특정 아티팩트의 메타데이터를 조회합니다.

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| id | UUID | Yes | 아티팩트 ID |

### Response (200 OK)
```json
{
  "id": "artifact-uuid-1",
  "executionId": "550e8400-e29b-41d4-a716-446655440000",
  "fileName": "README.md",
  "filePath": "artifacts/550e8400/output/README.md",
  "fileSize": 2048,
  "mimeType": "text/markdown",
  "type": "DOCUMENT",
  "status": "ACTIVE",
  "checksum": "sha256:abc123def456...",
  "createdAt": "2025-12-26T10:02:25Z",
  "expiresAt": "2026-01-25T10:02:25Z",
  "tags": {
    "generated": "true",
    "version": "1.0"
  }
}
```

---

## 5.3 Get Artifact Download URL

### Endpoint
- **Method**: GET
- **Path**: `/api/v1/artifacts/{id}/download-url`
- **Authentication**: Required

### Description
아티팩트 다운로드를 위한 Presigned URL을 생성합니다.

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| id | UUID | Yes | 아티팩트 ID |

### Query Parameters
| Parameter | Type | Required | Description | Default |
|-----------|------|----------|-------------|---------|
| expiresIn | number | No | URL 유효 시간 (초, 60-3600) | 300 |

### Response (200 OK)
```json
{
  "artifactId": "artifact-uuid-1",
  "downloadUrl": "https://bucket.s3.amazonaws.com/artifacts/...",
  "expiresAt": "2025-12-26T10:10:00Z",
  "fileName": "README.md",
  "fileSize": 2048,
  "mimeType": "text/markdown"
}
```

---

## 5.4 Download Artifact (Proxy)

### Endpoint
- **Method**: GET
- **Path**: `/api/v1/artifacts/{id}/download`
- **Authentication**: Required

### Description
아티팩트를 직접 다운로드합니다 (Backend가 S3를 프록시).

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| id | UUID | Yes | 아티팩트 ID |

### Response Headers
```
Content-Type: {mimeType}
Content-Disposition: attachment; filename="{fileName}"
Content-Length: {fileSize}
ETag: "{checksum}"
```

### Response
Binary file content (stream)

---

## 5.5 Delete Artifact

### Endpoint
- **Method**: DELETE
- **Path**: `/api/v1/artifacts/{id}`
- **Authentication**: Required

### Description
아티팩트를 삭제합니다 (S3 및 DB 모두에서 삭제).

### Path Parameters
| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| id | UUID | Yes | 아티팩트 ID |

### Response (204 No Content)
```
(empty body)
```

---

## Error Codes (Common)

| Code | HTTP Status | Description |
|------|-------------|-------------|
| NOT_FOUND | 404 | 아티팩트를 찾을 수 없음 |
| ARCHIVED | 410 | 아티팩트가 아카이브됨 (복원 필요) |
| UNAUTHORIZED | 401 | 인증 실패 |
| FORBIDDEN | 403 | 권한 없음 |
| INTERNAL_ERROR | 500 | 서버 내부 오류 |

---

## Related Specs
- FEAT-004
- DATA-001

---

## Change History

| Date | Author | Description |
|------|--------|-------------|
| 2025-12-26 | System | Initial creation |
